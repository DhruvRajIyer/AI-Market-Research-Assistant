<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Market Research Assistant</title>
  <!-- Google Fonts: Orbitron -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;500;600;700;800&display=swap" rel="stylesheet">
  <!-- Tailwind CSS via CDN -->
  <script src="https://cdn.tailwindcss.com"></script>
  <!-- Lucide Icons -->
  <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.js"></script>
  <!-- Custom Tailwind Config -->
  <script>
    tailwind.config = {
      darkMode: 'class',
      theme: {
        extend: {
          fontFamily: {
            sans: ['Orbitron', 'sans-serif'],
          },
          colors: {
            primary: {
              50: '#fefce8',
              100: '#fef9c3',
              200: '#fef08a',
              300: '#fde047',
              400: '#facc15',
              500: '#eab308',
              600: '#ca8a04',
              700: '#a16207',
              800: '#854d0e',
              900: '#713f12',
            },
            dark: {
              800: '#1a1a1a',
              900: '#0d0d0d',
              950: '#000000',
            },
            light: {
              50: '#ffffff',
              100: '#f8f9fa',
              200: '#e9ecef',
              300: '#dee2e6',
            }
          },
          backdropBlur: {
            xs: '2px',
          },
          animation: {
            'float': 'float 6s ease-in-out infinite',
            'glow': 'glow 2s ease-in-out infinite alternate',
            'slide-up': 'slideUp 0.5s ease-out',
            'fade-in': 'fadeIn 0.3s ease-out',
            'scale-in': 'scaleIn 0.2s ease-out',
            'pulse-glow': 'pulseGlow 2s ease-in-out infinite',
          },
          keyframes: {
            float: {
              '0%, 100%': { transform: 'translateY(0px)' },
              '50%': { transform: 'translateY(-10px)' },
            },
            glow: {
              '0%': { boxShadow: '0 0 20px rgba(234, 179, 8, 0.3)' },
              '100%': { boxShadow: '0 0 30px rgba(234, 179, 8, 0.6)' },
            },
            slideUp: {
              '0%': { transform: 'translateY(20px)', opacity: '0' },
              '100%': { transform: 'translateY(0)', opacity: '1' },
            },
            fadeIn: {
              '0%': { opacity: '0' },
              '100%': { opacity: '1' },
            },
            scaleIn: {
              '0%': { transform: 'scale(0.95)', opacity: '0' },
              '100%': { transform: 'scale(1)', opacity: '1' },
            },
            pulseGlow: {
              '0%, 100%': { boxShadow: '0 0 10px rgba(234, 179, 8, 0.2)' },
              '50%': { boxShadow: '0 0 20px rgba(234, 179, 8, 0.4)' },
            },
          }
        }
      }
    }
  </script>
  <style>
    /* Custom Glassmorphism Styles */
    .glass-dark {
      background: rgba(0, 0, 0, 0.4);
      backdrop-filter: blur(20px);
      -webkit-backdrop-filter: blur(20px);
      border: 1px solid rgba(234, 179, 8, 0.2);
    }
    
    .glass-light {
      background: rgba(255, 255, 255, 0.7);
      backdrop-filter: blur(20px);
      -webkit-backdrop-filter: blur(20px);
      border: 1px solid rgba(0, 0, 0, 0.1);
    }
    
    /* Background Styles */
    .bg-dark-mesh {
      background: 
        radial-gradient(at 20% 80%, rgba(234, 179, 8, 0.08) 0px, transparent 50%),
        radial-gradient(at 80% 20%, rgba(234, 179, 8, 0.05) 0px, transparent 50%),
        radial-gradient(at 40% 40%, rgba(234, 179, 8, 0.03) 0px, transparent 50%),
        #000000;
    }
    
    .bg-light-mesh {
      background: 
        radial-gradient(at 20% 80%, rgba(234, 179, 8, 0.03) 0px, transparent 50%),
        radial-gradient(at 80% 20%, rgba(0, 0, 0, 0.02) 0px, transparent 50%),
        #f8f9fa;
    }
    
    /* Custom Scrollbar */
    .custom-scrollbar::-webkit-scrollbar {
      width: 6px;
    }
    
    .custom-scrollbar::-webkit-scrollbar-track {
      background: rgba(255, 255, 255, 0.1);
      border-radius: 3px;
    }
    
    .custom-scrollbar::-webkit-scrollbar-thumb {
      background: rgba(234, 179, 8, 0.6);
      border-radius: 3px;
    }
    
    .custom-scrollbar::-webkit-scrollbar-thumb:hover {
      background: rgba(234, 179, 8, 0.8);
    }
    
    /* Enhanced Hover Effects */
    .hover-lift {
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    }
    
    .hover-lift:hover {
      transform: translateY(-3px);
    }
    
    .hover-glow:hover {
      box-shadow: 0 0 25px rgba(234, 179, 8, 0.4);
    }
    
    /* Loading Animation */
    .loading-dots {
      display: inline-block;
      position: relative;
      width: 80px;
      height: 80px;
    }
    
    .loading-dots div {
      position: absolute;
      top: 33px;
      width: 13px;
      height: 13px;
      border-radius: 50%;
      background: #eab308;
      animation-timing-function: cubic-bezier(0, 1, 1, 0);
    }
    
    .loading-dots div:nth-child(1) {
      left: 8px;
      animation: loading-dots1 0.6s infinite;
    }
    
    .loading-dots div:nth-child(2) {
      left: 8px;
      animation: loading-dots2 0.6s infinite;
    }
    
    .loading-dots div:nth-child(3) {
      left: 32px;
      animation: loading-dots2 0.6s infinite;
    }
    
    .loading-dots div:nth-child(4) {
      left: 56px;
      animation: loading-dots3 0.6s infinite;
    }
    
    @keyframes loading-dots1 {
      0% { transform: scale(0); }
      100% { transform: scale(1); }
    }
    
    @keyframes loading-dots3 {
      0% { transform: scale(1); }
      100% { transform: scale(0); }
    }
    
    @keyframes loading-dots2 {
      0% { transform: translate(0, 0); }
      100% { transform: translate(24px, 0); }
    }
    
    /* Button Styles */
    .btn-yellow {
      background: linear-gradient(135deg, #eab308 0%, #f59e0b 100%);
      color: #000000;
      font-weight: 600;
      transition: all 0.3s ease;
    }
    
    .btn-yellow:hover {
      background: linear-gradient(135deg, #f59e0b 0%, #fbbf24 100%);
      transform: translateY(-2px);
      box-shadow: 0 10px 25px rgba(234, 179, 8, 0.3);
    }
    
    /* Smooth transitions */
    * {
      transition: background-color 0.3s ease, border-color 0.3s ease, color 0.3s ease;
    }
    
    /* Floating particles */
    .particles {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      pointer-events: none;
      z-index: -1;
    }
    
    .particle {
      position: absolute;
      width: 3px;
      height: 3px;
      background: rgba(234, 179, 8, 0.4);
      border-radius: 50%;
      animation: float 8s ease-in-out infinite;
    }
    
    .particle:nth-child(1) { top: 15%; left: 15%; animation-delay: 0s; }
    .particle:nth-child(2) { top: 65%; left: 85%; animation-delay: 2s; }
    .particle:nth-child(3) { top: 85%; left: 35%; animation-delay: 4s; }
    .particle:nth-child(4) { top: 35%; left: 65%; animation-delay: 1s; }
    .particle:nth-child(5) { top: 5%; left: 95%; animation-delay: 3s; }
    .particle:nth-child(6) { top: 50%; left: 10%; animation-delay: 5s; }
    
    /* Text gradient */
    .text-yellow-gradient {
      background: linear-gradient(135deg, #eab308 0%, #fbbf24 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }
  </style>
</head>
<body class="min-h-screen font-sans bg-light-mesh dark:bg-black text-gray-800 dark:text-white">
  <!-- Floating Particles Background -->
  <div class="particles">
    <div class="particle"></div>
    <div class="particle"></div>
    <div class="particle"></div>
    <div class="particle"></div>
    <div class="particle"></div>
    <div class="particle"></div>
  </div>

  <!-- Theme Toggle -->
  <div class="fixed top-6 right-6 z-50">
    <button id="theme-toggle" class="p-3 rounded-full hover-lift hover-glow transition-all duration-300 glass-light dark:glass-dark">
      <i data-lucide="sun" class="w-5 h-5 text-primary-500 hidden dark:block"></i>
      <i data-lucide="moon" class="w-5 h-5 text-gray-800 dark:text-primary-500 block dark:hidden"></i>
    </button>
  </div>

  <div class="container mx-auto px-4 py-8 min-h-screen flex flex-col">
    <!-- Header -->
    <header class="text-center mb-12 animate-slide-up">
      <div class="inline-block mb-6">
        <div class="p-4 rounded-2xl hover-lift hover-glow glass-light dark:glass-dark">
          <i data-lucide="brain-circuit" class="w-12 h-12 text-primary-500 mx-auto mb-2"></i>
        </div>
      </div>
      <h1 class="text-5xl md:text-6xl font-bold text-yellow-gradient mb-4 animate-glow">
        Market Research Assistant
      </h1>
      <p class="text-lg text-gray-600 dark:text-gray-300 font-medium">
        Powered by Advanced AI Intelligence
      </p>
      <div class="flex justify-center mt-4">
        <div class="flex space-x-2">
          <div class="w-2 h-2 bg-primary-400 rounded-full animate-pulse"></div>
          <div class="w-2 h-2 bg-primary-500 rounded-full animate-pulse" style="animation-delay: 0.2s;"></div>
          <div class="w-2 h-2 bg-primary-600 rounded-full animate-pulse" style="animation-delay: 0.4s;"></div>
        </div>
      </div>
    </header>
    
    <!-- Main Content -->
    <div class="max-w-4xl mx-auto w-full flex-grow">
      <div class="rounded-3xl p-8 md:p-10 shadow-2xl hover-lift animate-fade-in glass-light dark:glass-dark">
        <!-- Research Form -->
        <form id="research-form" class="space-y-8">
          <!-- Input Field -->
          <div class="space-y-2">
            <label for="query" class="block text-sm font-semibold text-gray-700 dark:text-gray-200 mb-3 flex items-center">
              <i data-lucide="search" class="w-4 h-4 mr-2 text-primary-500"></i>
              Company or Sector Name
            </label>
            <div class="relative group">
              <input 
                type="text" 
                id="query" 
                name="query" 
                class="w-full px-6 py-4 glass-light dark:glass-dark rounded-2xl border-0 focus:outline-none focus:ring-2 focus:ring-primary-400 focus:ring-opacity-50 text-gray-800 dark:text-white placeholder-gray-500 dark:placeholder-gray-400 text-lg transition-all duration-300 hover-lift" 
                placeholder="Enter name (e.g., Apple Inc, Artificial Intelligence)" 
                required
              >
              <div class="absolute inset-0 rounded-2xl bg-gradient-to-r from-primary-400 to-primary-500 opacity-0 group-focus-within:opacity-10 transition-opacity duration-300 pointer-events-none"></div>
            </div>
          </div>
          
          <!-- Research Mode Dropdown -->
          <div class="space-y-2">
            <label for="mode" class="block text-sm font-semibold text-gray-700 dark:text-gray-200 mb-3 flex items-center">
              <i data-lucide="settings" class="w-4 h-4 mr-2 text-primary-500"></i>
              Research Mode
            </label>
            <div class="relative group">
              <select 
                id="mode" 
                name="mode" 
                class="w-full px-6 py-4 glass-light dark:glass-dark rounded-2xl border-0 focus:outline-none focus:ring-2 focus:ring-primary-400 focus:ring-opacity-50 text-black text-lg appearance-none cursor-pointer transition-all duration-300 hover-lift"
              >
                <option value="company-profile" class="bg-white dark:bg-gray-900 text-black">üè¢ Company Profile</option>
                <option value="swot-analysis" class="bg-white dark:bg-gray-900 text-black">üìä SWOT Analysis</option>
                <option value="sector-trends" class="bg-white dark:bg-gray-900 text-black">üìà Sector Trends</option>
                <option value="ai-impact" class="bg-white dark:bg-gray-900 text-black">ü§ñ AI Impact</option>
              </select>
              <i data-lucide="chevron-down" class="absolute right-4 top-1/2 transform -translate-y-1/2 w-5 h-5 text-primary-500 pointer-events-none"></i>
              <div class="absolute inset-0 rounded-2xl bg-gradient-to-r from-primary-400 to-primary-500 opacity-0 group-focus-within:opacity-10 transition-opacity duration-300 pointer-events-none"></div>
            </div>
          </div>
          
          <!-- Submit Button -->
          <div class="flex justify-center pt-4">
            <button 
              type="submit" 
              id="submit-btn"
              class="group relative px-8 py-4 btn-yellow rounded-2xl transition-all duration-300 transform hover:scale-105 focus:outline-none focus:ring-2 focus:ring-primary-400 focus:ring-opacity-50 min-w-[200px] animate-pulse-glow"
            >
              <span class="flex items-center justify-center text-black font-semibold">
                <i data-lucide="sparkles" class="w-5 h-5 mr-2 group-hover:animate-spin text-black"></i>
                Generate Research
              </span>
            </button>
          </div>
        </form>
        
        <!-- Loading Spinner -->
        <div id="loading" class="hidden py-16 flex flex-col items-center animate-fade-in">
          <div class="loading-dots mb-6">
            <div></div>
            <div></div>
            <div></div>
            <div></div>
          </div>
          <p class="text-gray-600 dark:text-gray-200 text-lg font-medium mb-2">Generating research...</p>
          <p class="text-gray-500 dark:text-gray-400 text-sm">This may take a moment</p>
          <div class="mt-4 w-64 h-1 bg-gray-200 dark:bg-gray-800 rounded-full overflow-hidden">
            <div class="h-full bg-gradient-to-r from-primary-400 to-primary-500 rounded-full animate-pulse"></div>
          </div>
        </div>
        
        <!-- Error Message -->
        <div id="error" class="hidden mt-8 p-6 glass-light dark:glass-dark rounded-2xl border-l-4 border-red-500 animate-scale-in">
          <div class="flex items-center">
            <i data-lucide="alert-circle" class="w-6 h-6 text-red-500 mr-3"></i>
            <div class="text-red-700 dark:text-red-300 font-medium" id="error-text"></div>
          </div>
        </div>
        
        <!-- Results Section -->
        <div id="result" class="hidden mt-10 animate-slide-up">
          <div class="flex items-center justify-between mb-6">
            <h2 id="result-title" class="text-2xl md:text-3xl font-bold text-gray-800 dark:text-white flex items-center">
              <i data-lucide="file-text" class="w-7 h-7 mr-3 text-primary-500"></i>
              Research Results
            </h2>
            <div class="flex items-center space-x-2">
              <div class="w-3 h-3 bg-primary-400 rounded-full animate-pulse"></div>
              <span class="text-sm text-gray-600 dark:text-gray-300 font-medium">Complete</span>
            </div>
          </div>
          
          <!-- Format and Export Options -->
          <div class="flex flex-col md:flex-row justify-between items-start md:items-center mb-6 space-y-4 md:space-y-0">
            <div class="flex flex-wrap gap-2">
              <button class="format-btn px-4 py-2 text-sm font-medium rounded-xl glass-light dark:glass-dark hover-lift transition-all duration-300 text-black" data-format="raw">
                <i data-lucide="file-text" class="w-4 h-4 mr-1 text-black"></i>
                Raw
              </button>
              <button class="format-btn px-4 py-2 text-sm font-medium rounded-xl glass-light dark:glass-dark hover-lift transition-all duration-300 text-black" data-format="markdown">
                <i data-lucide="hash" class="w-4 h-4 mr-1 text-black"></i>
                Markdown
              </button>
              <button class="format-btn active px-4 py-2 text-sm font-medium rounded-xl bg-primary-500 shadow-lg hover-lift transition-all duration-300 text-black" data-format="html">
                <i data-lucide="code" class="w-4 h-4 mr-1 text-black"></i>
                HTML
              </button>
            </div>
            <div class="flex flex-wrap gap-2">
              <button id="export-txt" class="px-4 py-2 text-sm font-medium rounded-xl btn-yellow transition-all duration-300 hover-lift flex items-center">
                <i data-lucide="download" class="w-4 h-4 mr-1 text-black"></i>
                <span class="text-black">Export TXT</span>
              </button>
              <button id="export-pdf" class="px-4 py-2 text-sm font-medium rounded-xl bg-gradient-to-r from-gray-600 to-gray-700 text-white hover:from-gray-700 hover:to-gray-800 transition-all duration-300 hover-lift flex items-center">
                <i data-lucide="file-down" class="w-4 h-4 mr-1 text-white"></i>
                <span class="text-white">Export PDF</span>
              </button>
            </div>
          </div>
          
          <!-- Result Content -->
          <div id="result-content" class="glass-light dark:glass-dark p-6 md:p-8 rounded-2xl border border-gray-200 dark:border-gray-700 overflow-auto max-h-[600px] custom-scrollbar text-black leading-relaxed"></div>
        </div>
      </div>
    </div>
  </div>
  
  <!-- Footer -->
  <footer class="py-8 text-center text-gray-600 dark:text-gray-400 text-sm mt-auto">
    <div class="rounded-2xl p-4 inline-block glass-light dark:glass-dark">
      <p class="font-medium text-black dark:text-white">Built by Dhruv Iyer ‚Äî AI for Business Transformation @ SKEMA</p>
    </div>
  </footer>
  
  <script>
    // Initialize Lucide icons
    lucide.createIcons();
    
    document.addEventListener('DOMContentLoaded', function() {
      // Theme toggle functionality
      const themeToggle = document.getElementById('theme-toggle');
      const html = document.documentElement;
      
      // Check for saved theme preference or default to dark mode
      const savedTheme = localStorage.getItem('theme') || 'dark';
      html.classList.toggle('dark', savedTheme === 'dark');
      
      themeToggle.addEventListener('click', () => {
        html.classList.toggle('dark');
        const isDark = html.classList.contains('dark');
        localStorage.setItem('theme', isDark ? 'dark' : 'light');
        
        // Add a subtle animation to the toggle button
        themeToggle.style.transform = 'scale(0.95)';
        setTimeout(() => {
          themeToggle.style.transform = 'scale(1)';
          lucide.createIcons(); // Refresh icons
        }, 150);
      });
      
      const form = document.getElementById('research-form');
      const submitBtn = document.getElementById('submit-btn');
      const loadingEl = document.getElementById('loading');
      const errorEl = document.getElementById('error');
      const errorText = document.getElementById('error-text');
      const resultEl = document.getElementById('result');
      const resultTitle = document.getElementById('result-title');
      const resultContent = document.getElementById('result-content');
      
      // Store the current result data
      let currentResultData = null;
      let currentDisplayFormat = 'html';
      
      // Format buttons
      const formatBtns = document.querySelectorAll('.format-btn');
      formatBtns.forEach(btn => {
        btn.addEventListener('click', () => {
          // Update active button with smooth transition
          formatBtns.forEach(b => {
            b.classList.remove('active', 'bg-primary-500', 'shadow-lg');
            b.classList.add('glass-light', 'dark:glass-dark');
            // Ensure text stays black
            b.classList.add('text-black');
          });
          btn.classList.remove('glass-light', 'dark:glass-dark');
          btn.classList.add('active', 'bg-primary-500', 'shadow-lg');
          // Ensure text stays black
          btn.classList.add('text-black');
          
          // Update content based on format if we have data
          if (currentResultData) {
            const format = btn.getAttribute('data-format');
            currentDisplayFormat = format;
            
            // Add fade transition
            resultContent.style.opacity = '0.5';
            setTimeout(() => {
              if (format === 'raw') {
                resultContent.innerHTML = currentResultData.analysis;
                resultContent.classList.remove('whitespace-pre-wrap');
              } else if (format === 'markdown') {
                resultContent.innerHTML = currentResultData.analysis;
                resultContent.classList.add('whitespace-pre-wrap');
              } else if (format === 'html') {
                resultContent.innerHTML = currentResultData.formatted_analysis || currentResultData.htmlAnalysis || currentResultData.analysis;
                resultContent.classList.remove('whitespace-pre-wrap');
              }
              resultContent.style.opacity = '1';
            }, 150);
          }
        });
      });
      
      // Form submission with enhanced animations
      form.addEventListener('submit', async (e) => {
        e.preventDefault();
        
        const query = document.getElementById('query').value.trim();
        const mode = document.getElementById('mode').value;
        
        if (!query) return;
        
        // Enhanced loading state
        submitBtn.disabled = true;
        submitBtn.innerHTML = '<i data-lucide="loader-2" class="w-5 h-5 mr-2 animate-spin text-black"></i><span class="text-black">Processing...</span>';
        lucide.createIcons();
        
        // Smooth transitions
        if (!resultEl.classList.contains('hidden')) {
          resultEl.style.opacity = '0';
          setTimeout(() => resultEl.classList.add('hidden'), 300);
        }
        
        if (!errorEl.classList.contains('hidden')) {
          errorEl.style.opacity = '0';
          setTimeout(() => errorEl.classList.add('hidden'), 300);
        }
        
        setTimeout(() => {
          loadingEl.classList.remove('hidden');
          loadingEl.style.opacity = '1';
        }, 300);
        
        try {
          // Map frontend mode values to backend mode values
          let apiMode = '';
          let entityType = 'company';
          
          switch (mode) {
            case 'company-profile':
              apiMode = 'profile';
              break;
            case 'swot-analysis':
              apiMode = 'swot';
              break;
            case 'sector-trends':
              apiMode = 'trends';
              entityType = 'sector';
              break;
            case 'ai-impact':
              apiMode = 'aiImpact';
              break;
          }
          
          const response = await fetch('/api/research', {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json'
            },
            body: JSON.stringify({ 
              query: query,
              mode: apiMode,
              entityType: entityType
            })
          });
          
          const data = await response.json();
          
          if (response.ok) {
            // Store data for format switching
            currentResultData = {
              ...data,
              htmlAnalysis: data.formatted_analysis || data.analysis
            };
            
            // Set title with animation
            resultTitle.innerHTML = `<i data-lucide="file-text" class="w-7 h-7 mr-3 text-primary-500"></i>Research Results: ${data.query || query}`;
            lucide.createIcons();
            
            // Display content based on format
            const activeFormat = document.querySelector('.format-btn.active')?.getAttribute('data-format') || 'html';
            
            if (activeFormat === 'raw') {
              resultContent.innerHTML = data.analysis;
            } else if (activeFormat === 'markdown') {
              resultContent.innerHTML = data.analysis;
              resultContent.classList.add('whitespace-pre-wrap');
            } else if (activeFormat === 'html') {
              resultContent.innerHTML = data.formatted_analysis || data.analysis;
            }
            
            // Hide loading and show results with animation
            loadingEl.style.opacity = '0';
            setTimeout(() => {
              loadingEl.classList.add('hidden');
              resultEl.classList.remove('hidden');
              resultEl.style.opacity = '1';
            }, 300);
            
            // Reset format buttons to HTML by default
            formatBtns.forEach(btn => {
              btn.classList.remove('active', 'bg-primary-500', 'shadow-lg');
              btn.classList.add('glass-light', 'dark:glass-dark');
              // Ensure text stays black
              btn.classList.add('text-black');
              if (btn.getAttribute('data-format') === 'html') {
                btn.classList.remove('glass-light', 'dark:glass-dark');
                btn.classList.add('active', 'bg-primary-500', 'shadow-lg');
                // Ensure text stays black
                btn.classList.add('text-black');
              }
            });
            
            currentDisplayFormat = 'html';
          } else {
            // Show error with animation
            errorText.textContent = `${data.error || 'Something went wrong'}`;
            loadingEl.style.opacity = '0';
            setTimeout(() => {
              loadingEl.classList.add('hidden');
              errorEl.classList.remove('hidden');
              errorEl.style.opacity = '1';
            }, 300);
          }
        } catch (error) {
          errorText.textContent = `${error.message}`;
          loadingEl.style.opacity = '0';
          setTimeout(() => {
            loadingEl.classList.add('hidden');
            errorEl.classList.remove('hidden');
            errorEl.style.opacity = '1';
          }, 300);
        } finally {
          // Reset button state
          submitBtn.disabled = false;
          submitBtn.innerHTML = '<i data-lucide="sparkles" class="w-5 h-5 mr-2 text-black"></i><span class="text-black font-semibold">Generate Research</span>';
          lucide.createIcons();
        }
      });
      
      // Export functionality with enhanced UX
      const exportTxtBtn = document.getElementById('export-txt');
      const exportPdfBtn = document.getElementById('export-pdf');
      
      // Export as TXT
      exportTxtBtn.addEventListener('click', async () => {
        if (!currentResultData) return;
        
        try {
          exportTxtBtn.disabled = true;
          exportTxtBtn.innerHTML = '<i data-lucide="loader-2" class="w-4 h-4 mr-1 animate-spin text-black"></i><span class="text-black">Exporting...</span>';
          lucide.createIcons();
          
          const query = currentResultData.query || document.getElementById('query').value;
          const mode = currentResultData.mode || document.getElementById('mode').value;
          const filename = `${query}_${mode}_research`;
          
          const response = await fetch('/api/export', {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json'
            },
            body: JSON.stringify({
              filename: filename,
              content: currentResultData.analysis,
              format: 'txt'
            })
          });
          
          if (response.ok) {
            const blob = await response.blob();
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.style.display = 'none';
            a.href = url;
            a.download = `${filename}.txt`;
            document.body.appendChild(a);
            a.click();
            window.URL.revokeObjectURL(url);
            
            // Success feedback
            exportTxtBtn.innerHTML = '<i data-lucide="check" class="w-4 h-4 mr-1 text-black"></i><span class="text-black">Downloaded!</span>';
            setTimeout(() => {
              exportTxtBtn.innerHTML = '<i data-lucide="download" class="w-4 h-4 mr-1 text-black"></i><span class="text-black">Export TXT</span>';
              lucide.createIcons();
            }, 2000);
          } else {
            const error = await response.json();
            throw new Error(error.message || 'Failed to export file');
          }
        } catch (error) {
          console.error('Export error:', error);
          exportTxtBtn.innerHTML = '<i data-lucide="x" class="w-4 h-4 mr-1 text-black"></i><span class="text-black">Failed</span>';
          setTimeout(() => {
            exportTxtBtn.innerHTML = '<i data-lucide="download" class="w-4 h-4 mr-1 text-black"></i><span class="text-black">Export TXT</span>';
            lucide.createIcons();
          }, 2000);
        } finally {
          exportTxtBtn.disabled = false;
          lucide.createIcons();
        }
      });
      
      // Export as PDF
      exportPdfBtn.addEventListener('click', async () => {
        if (!currentResultData) return;
        
        try {
          exportPdfBtn.disabled = true;
          exportPdfBtn.innerHTML = '<i data-lucide="loader-2" class="w-4 h-4 mr-1 animate-spin text-white"></i><span class="text-white">Exporting...</span>';
          lucide.createIcons();
          
          const query = currentResultData.query || document.getElementById('query').value;
          const mode = currentResultData.mode || document.getElementById('mode').value;
          const filename = `${query}_${mode}_research`;
          
          let htmlContent;
          if (currentDisplayFormat === 'html') {
            htmlContent = currentResultData.formatted_analysis || currentResultData.htmlAnalysis;
          }
          
          const response = await fetch('/api/export', {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json'
            },
            body: JSON.stringify({
              filename: filename,
              content: currentResultData.analysis,
              htmlContent: htmlContent,
              format: 'pdf'
            })
          });
          
          if (response.ok) {
            const blob = await response.blob();
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.style.display = 'none';
            a.href = url;
            a.download = `${filename}.pdf`;
            document.body.appendChild(a);
            a.click();
            window.URL.revokeObjectURL(url);
            
            // Success feedback
            exportPdfBtn.innerHTML = '<i data-lucide="check" class="w-4 h-4 mr-1 text-white"></i><span class="text-white">Downloaded!</span>';
            setTimeout(() => {
              exportPdfBtn.innerHTML = '<i data-lucide="file-down" class="w-4 h-4 mr-1 text-white"></i><span class="text-white">Export PDF</span>';
              lucide.createIcons();
            }, 2000);
          } else {
            const error = await response.json();
            throw new Error(error.message || 'Failed to export file');
          }
        } catch (error) {
          console.error('Export error:', error);
          exportPdfBtn.innerHTML = '<i data-lucide="x" class="w-4 h-4 mr-1 text-white"></i><span class="text-white">Failed</span>';
          setTimeout(() => {
            exportPdfBtn.innerHTML = '<i data-lucide="file-down" class="w-4 h-4 mr-1 text-white"></i><span class="text-white">Export PDF</span>';
            lucide.createIcons();
          }, 2000);
        } finally {
          exportPdfBtn.disabled = false;
          lucide.createIcons();
        }
      });
      
      // Add subtle parallax effect to particles
      window.addEventListener('mousemove', (e) => {
        const particles = document.querySelectorAll('.particle');
        const x = e.clientX / window.innerWidth;
        const y = e.clientY / window.innerHeight;
        
        particles.forEach((particle, index) => {
          const speed = (index + 1) * 0.3;
          const xOffset = (x - 0.5) * speed;
          const yOffset = (y - 0.5) * speed;
          
          particle.style.transform = `translate(${xOffset}px, ${yOffset}px)`;
        });
      });
      
      // Initialize icons after DOM is ready
      setTimeout(() => {
        lucide.createIcons();
      }, 100);
    });
  </script>
</body>
</html>

